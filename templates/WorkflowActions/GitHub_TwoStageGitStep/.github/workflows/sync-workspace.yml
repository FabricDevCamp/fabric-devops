name: Sync Workspace
run-name: Sync workspace from GIT branch ${{ github.ref_name }} 

on:
    workflow_dispatch:
    push:
      branches:
        - dev
        - main

jobs:
    deployment-job:
      name: Sync Workspace Items
      runs-on: ubuntu-latest
      permissions:
        contents: write
        
      steps:
        - name: Check out the code
          uses: actions/checkout@v4

        - name: Set up Python
          uses: actions/setup-python@v2
          with:
            python-version: "3.12"

        - name: Install msal
          run: |
              pip install msal

        - name: Sync Workspace Items
          env:
              REPOSITORY_NAME: ${{ github.repository }}
              BRANCH_NAME: ${{ github.ref_name }}
              FABRIC_TENANT_ID: ${{ vars.FABRIC_TENANT_ID }}
              FABRIC_CLIENT_ID: ${{ vars.FABRIC_CLIENT_ID }}
              FABRIC_CAPACITY_ID: ${{ vars.FABRIC_CAPACITY_ID }}         
              ADMIN_USER_ID: ${{ vars.ADMIN_USER_ID }}
              DEVELOPERS_GROUP_ID: ${{ vars.DEVELOPERS_GROUP_ID }}
              DEV_WORKSPACE_ID: ${{ vars.DEV_WORKSPACE_ID }}
              PROD_WORKSPACE_ID: ${{ vars.PROD_WORKSPACE_ID }}
              FABRIC_CLIENT_SECRET: ${{ secrets.FABRIC_CLIENT_SECRET }}
              GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          run: 
              python 'src/sync_workspace.py'
