parameters:
- name: environment
  displayName: Environment to deploy to
  type: string
  default: 'dev'
  values:
  - 'dev'
  - 'qa'
  - 'prod'
- name: runFullTests
  displayName: Run a full suite of tests?
  type: boolean
  default: false
- name: tag
  displayName: Release tag
  type: string
  default: ''

trigger: none

variables: 
- group: 'environmental_variables'

jobs:
- job: Create_Feature_Workspace
  pool:
    vmImage: ubuntu-latest
  steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.12'
      addToPath: true

  - script: pip install msal
    displayName: 'Install msal'

  - task: PythonScript@0  
    inputs:
      scriptSource: 'filePath'
      scriptPath: 'src/create_feature_workspace.py' 
      workingDirectory: '$(Build.SourcesDirectory)/src' # Optional: Specify the working directory for the script
      failOnStderr: true # Optional: Fail the task if any text is written to the stderr stream  
    env:
      FABRIC_CLIENT_ID: $(FABRIC_CLIENT_ID)
      FABRIC_CLIENT_SECRET: $(FABRIC_CLIENT_SECRET)
      FABRIC_TENANT_ID: $(FABRIC_TENANT_ID)
      SERVICE_PRINCIPAL_OBJECT_ID: $(SERVICE_PRINCIPAL_OBJECT_ID)
      ADMIN_USER_ID: $(ADMIN_USER_ID)
      FABRIC_CAPACITY_ID: $(FABRIC_CAPACITY_ID)
      WORKSPACE_ID: 'd7998094-6e80-4660-8015-645c91385a6d'